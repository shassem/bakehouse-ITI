pipeline {
    agent {label 'agent1'} 

    stages {

        
        stage('Ci') {
            steps {
                    
                withCredentials([usernamePassword(credentialsId: 'Dockerhub', usernameVariable: 'USERNAME', passwordVariable: 'PASSWORD')]) { 
                
                sh """
                    
                    docker build .  -t shassem/bakehouse:$BUILD_NUMBER
                    docker login -u ${USERNAME} -p ${PASSWORD}
                    docker push shassem/bakehouse:$BUILD_NUMBER
                    
                """
                
                }    

            }
        }        
        
        stage('Cd') {
            steps {
                    
                 
                withCredentials([file(credentialsId: 'configtxt', variable: 'kubeconf')]){
                       sh """
                            
                            kubectl apply --kubeconfig=${kubeconf} -f Deployment
 
                            
                       
                       """

                        
                    
                }
                 
                 
                 
            }     

            
        }         
   

   
   
        
        
        
        
        
    }
}